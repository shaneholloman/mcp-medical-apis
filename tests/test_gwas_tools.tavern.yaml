---
test_name: GWAS Catalog API Tools Test Suite

marks:
  - tavern
  - usefixtures:
      - server_process


stages:
  # Test 1: search_associations - Basic query
  - name: Search associations for diabetes
    request:
      url: "http://localhost:8000/tools/gwas/mcp"
      method: POST
      headers:
        Content-Type: "application/json"
        Accept: "application/json, text/event-stream"
      json:
        jsonrpc: "2.0"
        id: 1
        method: "tools/call"
        params:
          name: "gwas_search_associations"
          arguments:
            query: "diabetes"
            size: 5
    response:
      status_code: 200
      strict:
        - json:off
      json:
        jsonrpc: "2.0"
        id: 1
        result:
          content:
            - type: "text"
              text: !re_search "association|variant|study"
          isError: false

  # Test 2: search_studies - Basic query
  - name: Search studies for multiple sclerosis
    request:
      url: "http://localhost:8000/tools/gwas/mcp"
      method: POST
      headers:
        Content-Type: "application/json"
        Accept: "application/json, text/event-stream"
      json:
        jsonrpc: "2.0"
        id: 2
        method: "tools/call"
        params:
          name: "gwas_search_studies"
          arguments:
            trait: "multiple sclerosis"
            size: 5
    response:
      status_code: 200
      strict:
        - json:off
      json:
        jsonrpc: "2.0"
        id: 2
        result:
          content:
            - type: "text"
              text: !re_search "association|variant|study"
          isError: false

  # Test 4: Error handling - Invalid query
  - name: Search associations with invalid query
    request:
      url: "http://localhost:8000/tools/gwas/mcp"
      method: POST
      headers:
        Content-Type: "application/json"
        Accept: "application/json, text/event-stream"
      json:
        jsonrpc: "2.0"
        id: 4
        method: "tools/call"
        params:
          name: "gwas_search_associations"
          arguments:
            query: "INVALIDQUERY12345"
            size: 5
    response:
      status_code: 200
      strict:
        - json:off
      json:
        jsonrpc: "2.0"
        id: 4
        result:
          content:
            - type: "text"
              text: !re_search "no results|Error"
          isError: false
